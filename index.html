<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë²•ì¡°ë¬¸ ìë™ ì¶”ì¶œÂ·ê²€ìƒ‰ (í˜„í–‰ ìš°ì„  Â· ì¡°ë¡€ ê°•í™” Â· ê²½ê¸°ë„êµìœ¡ì²­ ìš°ì„ )</title>
<style>
  :root{--bg:#0b1020; --panel:#0f152b; --muted:#8ea0c7; --line:#1c2748; --accent:#78a6ff; --accent-2:#9ec1ff; --txt:#eaf1ff; --txt-muted:#aab9dd; --radius:14px; --shadow:0 10px 28px rgba(0,0,0,.32)}
  @media (prefers-color-scheme: light){ :root{ --bg:#f5f7ff; --panel:#fff; --muted:#596180; --line:#e6eaff; --accent:#2e5cff; --accent-2:#4c78ff; --txt:#0c1330; --txt-muted:#5e6a8a; --shadow:0 8px 20px rgba(15,23,52,.08)} }
  html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--txt)}
  .wrap{max-width:980px;margin:0 auto;padding:28px}
  header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:18px}
  .title{display:flex;flex-direction:column;gap:6px}
  h1{font-size:1.4rem;margin:0;letter-spacing:.2px}
  .sub{font-size:.92rem;color:var(--txt-muted)}
  .card{border:1px solid var(--line);background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow)}
  .card.pad{padding:16px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media (max-width: 900px){ .grid{grid-template-columns:1fr} }

  textarea{width:100%;min-height:120px;height:140px;padding:12px;border-radius:12px;border:1px solid var(--line);background:transparent;color:var(--txt);resize:vertical;box-sizing:border-box;line-height:1.45;}
  textarea:focus{outline:none;box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent)}

  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .label{font-weight:600;color:var(--txt-muted);font-size:.92rem}
  input[type="text"]{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:transparent;color:var(--txt);min-width:260px}
  input::placeholder{color:var(--muted)}
  .btn{padding:10px 14px;border:1px solid transparent;border-radius:10px;background:var(--accent);color:#fff;cursor:pointer;transition:transform .06s ease,opacity .2s}
  .btn:hover{transform:translateY(-1px)}
  .btn.secondary{background:transparent;color:var(--accent);border-color:color-mix(in oklab, var(--accent) 30%, #0000)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .badge{display:inline-flex;gap:6px;align-items:center;padding:2px 8px;border-radius:999px;background:color-mix(in oklab, var(--accent) 14%, transparent);color:var(--accent-2);border:1px solid var(--line);font-size:.8rem}
  .result{margin-top:18px}
  .result h2{margin:0 0 8px;font-size:1.05rem}

  ol{margin:0;padding-left:20px}
  .item{padding:10px 8px;border-top:1px dashed var(--line)}
  .item-line{display:flex;align-items:center;gap:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .t{font-weight:700;flex:0 0 auto}
  .meta{font-size:.86rem;color:var(--txt-muted);flex:0 0 auto}
  .links{display:flex;gap:10px;flex:0 0 auto}
  .links a,.links button{color:var(--accent-2);text-decoration:none;border:1px dashed color-mix(in oklab, var(--accent) 30%, transparent);background:transparent;border-radius:8px;padding:4px 8px;cursor:pointer;font-size:.86rem;}
  .links a:hover,.links button:hover{text-decoration:underline}

  .mini{font-size:.86rem;color:var(--txt-muted)}
  .right{margin-left:auto}
  .toast{position:fixed;right:18px;bottom:18px;display:none;z-index:50}
  .toast.on{display:block}
  .toast .box{background:var(--panel);border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);padding:12px 14px;min-width:240px}
  .skeleton{background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.14), rgba(255,255,255,.06));background-size:200% 100%;animation:shimmer 1.1s infinite}
  @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  .sk-line{height:14px;border-radius:6px;opacity:.45}
  .sk-gap{height:10px}

  .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:100}
  .modal.on{display:flex}
  .modal .panel{max-width:840px;max-height:80vh;overflow:auto;background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:16px}
  .modal h3{margin:0 0 8px;font-size:1.05rem}
  .modal .close{position:sticky;top:0;float:right;border:none;background:transparent;color:var(--txt-muted);cursor:pointer;font-size:1rem}
  .article-body{line-height:1.6}
  .article-body .hang{margin-left:12px}
  .article-body .ho{margin-left:24px}
  .article-body .mok{margin-left:36px}
  .article-body b{color:var(--accent-2)}
  .article-body .hang > b,.article-body .ho > b,.article-body .mok > b{display:none !important;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>ë²•ì¡°ë¬¸ ìë™ ì¶”ì¶œÂ·ê²€ìƒ‰</h1>
      <div class="sub">ë³¸ë¬¸ì—ì„œ <b>ë²•ë ¹/ìì¹˜ë²•ê·œ</b>ë¥¼ ì°¾ì•„ <b>ì¡°ë¬¸ ë¯¸ë¦¬ë³´ê¸°</b>ì™€ <b>ì „ì²´ ë³¸ë¬¸</b> ë§í¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. <span class="mini">í˜„í–‰ ìš°ì„ , ì—†ìœ¼ë©´ ë¹„í˜„í–‰Â·ê³µê°œê²€ìƒ‰ê¹Œì§€ í´ë°±</span></div>
    </div>
    <div class="badge">OC: bro3362</div>
  </header>

  <div class="grid">
    <section class="card pad">
      <div class="row" style="margin-bottom:8px"><div class="label">ë³¸ë¬¸ ì…ë ¥</div></div>
      <textarea id="input" placeholder="ì˜ˆ) ã€Œê²½ê¸°ë„êµìœ¡ì²­ í–‰ì •ê¸°êµ¬ ë° ì •ì› ì¡°ë¡€ã€ ì œ5ì¡°, ã€Œì‚¬ë¦½í•™êµë²•ã€ ì œ43ì¡° â€¦"></textarea>
      <div class="row" style="margin-top:10px">
        <button id="run" class="btn" type="button">ì¶”ì¶œÂ·ê²€ìƒ‰</button>
        <button id="clear" class="btn secondary" type="button">ì§€ìš°ê¸°</button>
        <span class="mini">Enter(âŒ¥/Alt+EnterëŠ” ì¤„ë°”ê¿ˆ)</span>
        <span class="right mini">ì‘ë‹µì´ ì—†ì„ ë•Œ í”„ë¡ì‹œ ì‚¬ìš©ë¨</span>
      </div>
    </section>

    <aside class="card pad">
      <div class="row" style="margin-bottom:10px"><div class="label">í”„ë¡ì‹œ</div></div>
      <input id="proxy" type="text" value="https://law-proxy.hyok96.workers.dev/?url=" style="width:100%"/>
      <div class="mini" style="margin-top:8px">CORSë¡œ ë³¸ë¬¸ì„ ëª» ì½ì„ ë•Œ ìë™ìœ¼ë¡œ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</div>
    </aside>
  </div>

  <section class="card pad result" id="resBox">
    <h2>ê²€ìƒ‰ ê²°ê³¼</h2>
    <ol id="resList"></ol>
  </section>
</div>

<div id="toast" class="toast"><div class="box mini" id="toastMsg">ì•ˆë‚´</div></div>

<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="panel">
    <button class="close" id="modalClose" title="ë‹«ê¸°" type="button">âœ•</button>
    <h3 id="modalTitle">ì¡°ë¬¸ ì „ë¬¸</h3>
    <div id="modalBody" class="article-body mini">ë¡œë”© ì¤‘â€¦</div>
  </div>
</div>

<script>
/* =============== ê³µí†µ ìœ í‹¸ =============== */
var DRF='https://www.law.go.kr/DRF';
var OC='bro3362';
var $=sel=>document.querySelector(sel);
var enc=s=>encodeURIComponent(s);
var pad=(n,w)=>String(parseInt(n,10)).padStart(w,'0');
var proxyBase=()=>{var pv=$('#proxy'); var v=pv&&pv.value?pv.value.trim():'https://law-proxy.hyok96.workers.dev/?url='; return v};
var buildURL=(p,params)=>{var u=new URL(DRF+p); Object.keys(params).forEach(k=>{var v=params[k]; if(v!=null&&v!=='') u.searchParams.set(k,v)}); return u.toString()};
var withProxy=(url,base)=>{var b=(base||'https://law-proxy.hyok96.workers.dev/?url=').trim(); if(b.indexOf('?')===-1) b+=(b.endsWith('/')?'':'/')+'?'; if(!/\burl=/.test(b)) b+='url='; return b+encodeURIComponent(url)};
var isFailPage=html=>/í˜ì´ì§€\s*ì ‘ì†ì—\s*ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤|ì‚¬ìš©ìì¸ì¦ì—\s*ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤|í˜ì´ì§€ë¥¼\s*ì°¾ì„\s*ìˆ˜\s*ì—†ìŠµë‹ˆë‹¤/.test((html||'').replace(/\u00A0/g,' '));
var publicLawURL=name=>'https://www.law.go.kr/ë²•ë ¹/'+enc(name);
var publicOrdinSearchURL=q=>'https://www.law.go.kr/ordinSc.do?menuId=3&subMenuId=27&tabMenuId=139&query='+enc(q));
var buildLawFullHTMLURL=id=>buildURL('/lawService.do',{OC:OC,target:'law',type:'HTML',ID:id});
var buildOrdinFullHTMLURL=(id,mst)=>{var p={OC:OC,target:'ordin',type:'HTML'}; if(mst) p.MST=mst; else if(id) p.ID=id; return buildURL('/lawService.do',p)};
var joTo6=(jo,joi)=>{var h=pad(jo,4);return joi?h+pad(joi,2):h+'00'};
var buildLawArticleURL=(id,obj)=>{var JO=joTo6(obj.jo,obj.joi); var HANG=(obj.hang?pad(obj.hang,6):(obj.ho?'000000':'')); var HO=(obj.ho?pad(obj.ho,6):''); var MOK=(obj.mok?String(obj.mok).trim().slice(0,1).replace(/[^ê°€-í£]/u,''):''); var p={OC:OC,target:'lawjosub',type:'HTML',ID:id,JO:JO}; if(HANG)p.HANG=HANG; if(HO)p.HO=HO; if(MOK)p.MOK=MOK; return buildURL('/lawService.do',p)};
var buildLawArticleXMLURL=(id,obj)=>{var JO=joTo6(obj.jo,obj.joi); var HANG=(obj.hang?pad(obj.hang,6):(obj.ho?'000000':'')); var HO=(obj.ho?pad(obj.ho,6):''); var MOK=(obj.mok?String(obj.mok).trim().slice(0,1).replace(/[^ê°€-í£]/u,''):''); var p={OC:OC,target:'lawjosub',type:'XML',ID:id,JO:JO}; if(HANG)p.HANG=HANG; if(HO)p.HO=HO; if(MOK)p.MOK=MOK; return buildURL('/lawService.do',p)};

/* ğŸ”§ ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •: ì•ˆì „í•œ try/catch ë²„ì „ */
async function fetchTextDirectOrProxy(url, opts) {
  opts = opts || {};
  const timeoutMs = opts.timeoutMs || 9000;

  const fetchWithTimeout = (u) => {
    const ac = new AbortController();
    const id = setTimeout(() => ac.abort(), timeoutMs);
    return fetch(u, { signal: ac.signal, credentials: 'omit' })
      .finally(() => clearTimeout(id));
  };

  try {
    // 1ì°¨: ì§ì ‘ ìš”ì²­
    const r = await fetchWithTimeout(url);
    if (r.ok) {
      const t = await r.text();
      const ct = (r.headers.get('content-type') || '');
      if (ct.indexOf('json') > -1 || t.length > 30) return t;
    }
    throw new Error('direct fail');
  } catch (_) {
    try {
      // 2ì°¨: í”„ë¡ì‹œë¡œ ì¬ì‹œë„
      const r2 = await fetchWithTimeout(withProxy(url, proxyBase()));
      if (r2.ok) {
        const t2 = await r2.text();
        const ct2 = (r2.headers.get('content-type') || '');
        if (ct2.indexOf('json') > -1 || t2.length > 30) return t2;
      }
      return '';
    } catch (_e) {
      return '';
    }
  }
}

/* =============== ì •ê·œí™”/ë³´ì¡° =============== */
var canonName=s=>(s||'').replace(/[\s"â€œâ€'â€˜â€™\[\]\(\)ã€Œã€]/g,'').replace(/[Â·ã†]/g,'');
var displayName=s=>(s||'').replace(/["â€œâ€'â€˜â€™\[\]\(\)ã€Œã€]/g,'').trim();
function refineLawName(name){
  var s=(name||'').trim(); if(!s) return s;
  s=s.replace(/^(?:ê¹Œì§€|ë°|ë˜ëŠ”|ë“±|ê´€ë ¨|ê´€í•œ|ë”°ë¥¸|ì—\s*ë”°ë¥¸|ì—\s*ì˜í•œ|ì˜)\s+/, '');
  var m=s.match(/^(.*?ë²•(?:ë¥ )?)(?:\s*)?(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)$/u);
  if(m) return (m[1]+' '+m[2]).trim();
  var toks=s.split(/\s+/); var cut=-1;
  for(var k=toks.length-1;k>=0;k--){ if(/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(toks[k])){ cut=k; break; } }
  if(cut>=0){
    if(toks[cut+1] && /^(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)$/u.test(toks[cut+1])) return toks.slice(0, cut+2).join(' ').trim();
    return toks.slice(0, cut+1).join(' ').trim();
  }
  return s;
}
var isCurrent = v=>/í˜„í–‰/u.test((v||'').trim());

/* =============== êµ­ê°€ë²•ë ¹ ê²€ìƒ‰(ë²•) =============== */
async function tryLawSearchAll(qCanon,qRaw){
  function clean(s){return canonName(refineLawName(s||''))}
  function pick(rows,preferCurrent){
    if(!rows||!rows.length) return null;
    var want=clean(qCanon);
    var pool=preferCurrent? rows.filter(r=>isCurrent(r.status)) : rows.slice();
    if(preferCurrent && !pool.length) pool=rows.slice();
    var exact=pool.find(x=>clean(x.name)===want);
    return exact || pool[0] || null;
  }
  async function j(){
    var url=buildURL('/lawSearch.do',{OC:OC,target:'law',type:'JSON',query:qRaw,display:10});
    var t=await fetchTextDirectOrProxy(url); try{
      var d=JSON.parse(t); var root=d&&(d.LawSearch||d);
      var rows=[]; if(root&&root.law){ rows=Array.isArray(root.law)?root.law:[root.law] }
      return rows.map(x=>({kind:'law',name:(x.ë²•ë ¹ëª…í•œê¸€||'').trim(),id:(x.ë²•ë ¹ID||'').trim(),lsiSeq:(x.ë²•ë ¹ì¼ë ¨ë²ˆí˜¸||'').trim(),status:(x.ë²•ë ¹ìƒíƒœ||x.ë²•ë ¹ìƒíƒœëª…||'').trim()}));
    }catch(_){ return null; }
  }
  async function x(){
    var url=buildURL('/lawSearch.do',{OC:OC,target:'law',type:'XML',query:qRaw,display:10});
    var t=await fetchTextDirectOrProxy(url); try{
      var dom=new DOMParser().parseFromString(t,'text/xml');
      var list=[].slice.call(dom.getElementsByTagName('law'));
      return list.map(n=>{var g=tag=>{var el=n.getElementsByTagName(tag)[0]; return el?(el.textContent||'').trim():''};
        return {kind:'law',name:g('ë²•ë ¹ëª…í•œê¸€'),id:g('ë²•ë ¹ID'),lsiSeq:g('ë²•ë ¹ì¼ë ¨ë²ˆí˜¸'),status:(g('ë²•ë ¹ìƒíƒœ')||g('ë²•ë ¹ìƒíƒœëª…'))};});
    }catch(_){ return null; }
  }
  async function hDRF(){
    var url=buildURL('/lawSearch.do',{OC:OC,target:'law',type:'HTML',query:qRaw,display:10});
    var t=await fetchTextDirectOrProxy(url); try{
      var dom=new DOMParser().parseFromString(t,'text/html');
      var rows=[].slice.call(dom.querySelectorAll('a[href*="ID="]')).map(a=>{
        var href=a.getAttribute('href')||''; var m=href.match(/ID=([^&]+)/);
        return {kind:'law', name:(a.textContent||'').trim(), id:m?decodeURIComponent(m[1]):'', lsiSeq:'', status:''};
      }).filter(x=>x.id);
      return rows;
    }catch(_){ return null; }
  }
  async function hPublic(){
    var url='https://www.law.go.kr/lsSc.do?menuId=1&subMenuId=15&tabMenuId=81&query='+enc(qRaw);
    var t=await fetchTextDirectOrProxy(url); try{
      var dom=new DOMParser().parseFromString(t,'text/html');
      var rows=[].slice.call(dom.querySelectorAll('a[href*="ID="]')).map(a=>{
        var txt=(a.textContent||'').trim(); var href=a.getAttribute('href')||''; var id=(href.match(/ID=([^&]+)/)||[])[1]||'';
        return id? {kind:'law', name:txt, id:decodeURIComponent(id), lsiSeq:'', status:''} : null;
      }).filter(Boolean); return rows;
    }catch(_){ return null; }
  }
  var arr = await j() || await x();
  var chosen = pick(arr||[], true);
  if(chosen) return chosen;
  var arr2 = arr || await x() || await hDRF() || await hPublic() || [];
  return pick(arr2, false);
}

/* =============== ìì¹˜ë²•ê·œ ê²€ìƒ‰(ì¡°ë¡€/ê·œì¹™) â€” ê²½ê¸°ë„êµìœ¡ì²­ ìš°ì„  =============== */
async function tryOrdinSearchAll(qCanon,qRaw){
  function score(row,want){
    var s=0;
    if(row.org && /ê²½ê¸°ë„êµìœ¡ì²­/u.test(row.org)) s+=6;
    if(row.name && /ê²½ê¸°ë„êµìœ¡ì²­/u.test(row.name)) s+=4;
    if(isCurrent(row.status)) s+=3;
    var clean=z=>canonName(refineLawName(z||'')); if(clean(row.name)===clean(want)) s+=5;
    return s;
  }
  function pick(rows,preferCurrent){
    if(!rows||!rows.length) return null;
    var pool=rows.slice();
    if(preferCurrent){ var cur=pool.filter(r=>isCurrent(r.status)); if(cur.length) pool=cur; }
    pool.sort((a,b)=>score(b,qCanon)-score(a,qCanon));
    return pool[0]||null;
  }
  async function j(){
    var url=buildURL('/lawSearch.do',{OC:OC,target:'ordin',type:'JSON',query:qRaw,display:10});
    var t=await fetchTextDirectOrProxy(url); try{
      var d=JSON.parse(t); var root=d&&(d.OrdinSearch||d);
      var rows=[]; if(root&&root.ordin){ rows=Array.isArray(root.ordin)?root.ordin:[root.ordin] }
      return rows.map(x=>{
        const name=(x.ìì¹˜ë²•ê·œëª…||x.ìì¹˜ë²•ê·œëª…í•œê¸€||x.ìì¹˜ë²•ê·œëª…êµ­ë¬¸||'').trim();
        const id=(x.ìì¹˜ë²•ê·œID||x.ID||'').trim();
        const mst=(x.ìì¹˜ë²•ê·œì¼ë ¨ë²ˆí˜¸||x.MST||'').trim();
        const org=(x.ì§€ìì²´ëª…||x.ì§€ìì²´ê¸°ê´€ëª…||'').trim();
        const status=(x.ìì¹˜ë²•ê·œìƒíƒœ||x.ìì¹˜ë²•ê·œìƒíƒœëª…||'').trim();
        return {kind:'ordin',name,id,mst,org,status};
      });
    }catch(_){ return null; }
  }
  async function x(){
    var url=buildURL('/lawSearch.do',{OC:OC,target:'ordin',type:'XML',query:qRaw,display:10});
    var t=await fetchTextDirectOrProxy(url); try{
      var dom=new DOMParser().parseFromString(t,'text/xml');
      var list=[].slice.call(dom.getElementsByTagName('ordin'));
      return list.map(n=>{
        var g=tag=>{var el=n.getElementsByTagName(tag)[0]; return el?(el.textContent||'').trim():''};
        const name=g('ìì¹˜ë²•ê·œëª…')||g('ìì¹˜ë²•ê·œëª…í•œê¸€')||g('ìì¹˜ë²•ê·œëª…êµ­ë¬¸');
        const id=g('ìì¹˜ë²•ê·œID')||g('ID'); const mst=g('ìì¹˜ë²•ê·œì¼ë ¨ë²ˆí˜¸')||g('MST');
        const org=g('ì§€ìì²´ëª…')||g('ì§€ìì²´ê¸°ê´€ëª…'); const status=g('ìì¹˜ë²•ê·œìƒíƒœ')||g('ìì¹˜ë²•ê·œìƒíƒœëª…')||g('ìƒíƒœ');
        return {kind:'ordin',name,id,mst,org,status};
      });
    }catch(_){ return null; }
  }
  async function hDRF(){
    var url=buildURL('/lawSearch.do',{OC:OC,target:'ordin',type:'HTML',query:qRaw,display:10});
    var t=await fetchTextDirectOrProxy(url); try{
      var dom=new DOMParser().parseFromString(t,'text/html');
      var rows=[].slice.call(dom.querySelectorAll('a[href*="MST="], a[href*="ID="]')).map(a=>{
        var href=a.getAttribute('href')||''; var id=(href.match(/ID=([^&]+)/)||[])[1]||''; var mst=(href.match(/MST=([^&]+)/)||[])[1]||'';
        return {kind:'ordin', name:(a.textContent||'').trim(), id:decodeURIComponent(id||''), mst:decodeURIComponent(mst||''), org:'', status:''};
      }).filter(x=>x.id||x.mst); return rows;
    }catch(_){ return null; }
  }
  async function hPublic(){
    var url='https://www.law.go.kr/ordinSc.do?menuId=3&subMenuId=27&tabMenuId=139&query='+enc(qRaw);
    var t=await fetchTextDirectOrProxy(url); try{
      var dom=new DOMParser().parseFromString(t,'text/html');
      var rows=[].slice.call(dom.querySelectorAll('a[href*="MST="], a[href*="ID="]')).map(a=>{
        var href=a.getAttribute('href')||''; var id=(href.match(/ID=([^&]+)/)||[])[1]||''; var mst=(href.match(/MST=([^&]+)/)||[])[1]||'';
        var txt=(a.textContent||'').trim(); if(!(id||mst)) return null;
        return {kind:'ordin', name:txt, id:decodeURIComponent(id||''), mst:decodeURIComponent(mst||''), org:'', status:''};
      }).filter(Boolean); return rows;
    }catch(_){ return null; }
  }
  var arr = await j() || await x();
  var chosen = pick(arr||[], true);
  if(chosen) return chosen;
  var arr2 = arr || await x() || await hDRF() || await hPublic() || [];
  return pick(arr2, false);
}

/* =============== ì¶”ì¶œê¸°(ë¸Œë¼ìš°ì € ì•ˆì „í˜•) =============== */
(function(){
  'use strict';
  var D='\\d+'; var JO='ì œ\\s*('+D+')\\s*ì¡°(?:\\s*ì˜\\s*('+D+'))?'; var HANG='(?:\\s*ì œ?\\s*('+D+')\\s*í•­)?';
  var HO='(?:\\s*ì œ?\\s*('+D+')\\s*í˜¸)?'; var MOK='(?:\\s*([ê°€-í£])\\s*ëª©)?';
  var SUPER_RE=new RegExp(['[ã€Œã€â€œ"\']?\\s*','([ê°€-í£A-Za-z0-9Â·ã†\\s]+?(?:ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)(?:\\s*(?:ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™))?)','\\s*[ã€ã€â€"\']?','(?:\\s*',JO,HANG,HO,MOK,')?'].join(''),'gu');
  function skipCtx(name){var s=(name||'').replace(/\s+/g,''); return s==='ê°™ì€ë²•'||s==='ë™ë²•'||s==='ê°™ì€ë²•ì‹œí–‰ë ¹'||s==='ë™ë²•ì‹œí–‰ë ¹'||s==='ê°™ì€ë²•ì‹œí–‰ê·œì¹™'||s==='ë™ë²•ì‹œí–‰ê·œì¹™';}
  function isLikelyLawName(name){var s=(name||'').trim(); if(!s) return false; if(/^(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(s)) return false; if(/ë°©ë²•$/u.test(s)) return false; var core=s.replace(/\s*(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)$/u,''); if(!/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(core)) return false; return core.replace(/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u,'').length>=1;}
  function refineLawName2(name){var s=(name||'').trim(); if(!s) return s; s=s.replace(/^(?:ê¹Œì§€|ë°|ë˜ëŠ”|ë“±|ê´€ë ¨|ê´€í•œ|ë”°ë¥¸|ì—\s*ë”°ë¥¸|ì—\s*ì˜í•œ|ì˜)\s+/u,''); var toks=s.split(/\s+/); var last=-1; for(var i=toks.length-1;i>=0;i--){ if(/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(toks[i])){ last=i; break; } } if(last>=0){ if(toks[last+1]&&/^(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)$/u.test(toks[last+1])) return toks.slice(0,last+2).join(' '); return toks.slice(0,last+1).join(' ');} return s;}
  function cleanDisplay(s){ return (s||'').replace(/[\"â€œâ€'â€˜â€™\[\]\(\)ã€Œã€ã€ã€]/g,'').trim(); }
  window.__LAW_EXTRACT__=function(text){
    var src=(text||'').replace(/[\u200B-\u200D\uFEFF]/g,'').replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g,' ').replace(/\s+/g,' ').trim();
    var out=[], seen=new Set(); SUPER_RE.lastIndex=0; var m;
    while((m=SUPER_RE.exec(src))){
      var nm=refineLawName2(cleanDisplay(m[1]||'')); if(!nm||skipCtx(nm)||!isLikelyLawName(nm)) continue;
      var jo=m[2]||null, joi=m[3]||null, hang=m[4]||null, ho=m[5]||null, mok=m[6]||null;
      var prev=src.slice(Math.max(0,SUPER_RE.lastIndex-(m[0]||'').length-20), SUPER_RE.lastIndex-(m[0]||'').length); if(/ì œ\s*\d+\s*ì¡°\s*$/u.test(prev)) continue;
      var key=[nm,jo||'',joi||'',hang||'',ho||'',mok||''].join('|'); if(seen.has(key)) continue; seen.add(key);
      out.push({name:nm, jo:jo, joi:joi, hang:hang, ho:ho, mok:mok});
    }
    var withArticle=new Set(out.filter(x=>!!x.jo).map(x=>x.name));
    out=out.filter(x=> x.jo ? true : !withArticle.has(x.name));
    var seenNameOnly=new Set();
    out=out.filter(x=>{ if(x.jo) return true; var k='nameonly|'+x.name; if(seenNameOnly.has(k)) return false; seenNameOnly.add(k); return true; });
    return out;
  };
})();

/* =============== ë¶„ë¥˜/ë¼ìš°íŒ… =============== */
function classifyKind(name){
  const s=(name||'').trim();
  if (/(ì¡°ë¡€|ê·œì¹™)\s*(ì‹œí–‰ê·œì¹™)?$/u.test(s)) return 'ordin';
  if (/(ë²•|ë²•ë¥ )\s*(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)?$/u.test(s)) return 'law';
  if (/êµìœ¡ì²­|ì‹œì²­|êµ°ì²­|êµ¬ì²­|ë„ì˜íšŒ|ì‹œì˜íšŒ|êµ¬ì˜íšŒ/u.test(s)) return 'ordin';
  return 'law';
}
function hasOrdinHint(name){ return /(ì¡°ë¡€|ê·œì¹™)/u.test(name||''); }

async function searchOneCitation(it){
  const firstKind = classifyKind(it.name);
  let row=null;
  if(firstKind==='ordin'){ row=await tryOrdinSearchAll(it.name,it.name); if(!row) row=await tryLawSearchAll(it.name,it.name); }
  else { row=await tryLawSearchAll(it.name,it.name); if(!row && hasOrdinHint(it.name)) row=await tryOrdinSearchAll(it.name,it.name); }
  const kind = row ? row.kind : (firstKind==='ordin'?'ordin':'law');
  return {row, kind, cite:it};
}

/* =============== ë¯¸ë¦¬ë³´ê¸° ë Œë” =============== */
function sanitize(html){return (html||'').replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,'')}
async function fetchArticleXML(urlXML){
  var xmlText=await fetchTextDirectOrProxy(urlXML); if(!xmlText) return null;
  var dom; try{ dom=new DOMParser().parseFromString(xmlText,'text/xml'); }catch(e){ return null; }
  var get=(tag,node)=>{node=node||dom; var el=node.getElementsByTagName(tag)[0]; return el? (el.textContent||'').trim() : ''};
  var title=get('ì¡°ë¬¸ì œëª©')||''; var articleBodyRaw=get('ì¡°ë¬¸ë‚´ìš©')||'';
  var hangs=[].slice.call(dom.getElementsByTagName('í•­')).map(function(h){
    var hTitle=(h.getElementsByTagName('í•­ë‚´ìš©')[0]||{}).textContent; hTitle=hTitle? hTitle.trim():'';
    var hos=[].slice.call(h.getElementsByTagName('í˜¸')).map(function(ho){
      var hoText=(ho.getElementsByTagName('í˜¸ë‚´ìš©')[0]||{}).textContent; hoText=hoText? hoText.trim():'';
      var moks=[].slice.call(ho.getElementsByTagName('ëª©')).map(function(m){return (m.textContent||'').trim()});
      return {hoText:hoText, moks:moks};
    });
    return {hTitle:hTitle, hos:hos};
  });
  return {title:title, articleBodyRaw:articleBodyRaw, hangs:hangs};
}
async function fetchOrdinAndPick(ID_or_MST, jo){
  var p={OC:OC,target:'ordin',type:'XML'}; if(/^\d+$/u.test(ID_or_MST)&&ID_or_MST.length>7){ p.ID=ID_or_MST; } else { p.MST=ID_or_MST; }
  var url=buildURL('/lawService.do',p); var xmlText=await fetchTextDirectOrProxy(url); if(!xmlText) return null;
  var dom; try{ dom=new DOMParser().parseFromString(xmlText,'text/xml'); }catch(e){ return null; }
  var nodes=[].slice.call(dom.getElementsByTagName('ì¡°ë¬¸'));
  var target = nodes.find(function(n){ var no=(n.getElementsByTagName('ì¡°ë¬¸ë²ˆí˜¸')[0]||{}).textContent||''; return no.replace(/\s+/g,'')===('ì œ'+parseInt(jo,10)+'ì¡°').replace(/\s+/g,'') || no.indexOf('ì œ'+parseInt(jo,10)+'ì¡°')===0; }) || nodes[0];
  if(!target) return null;
  var get=(tag,node)=>{ node=node||target; var el=node.getElementsByTagName(tag)[0]; return el? (el.textContent||'').trim() : '' };
  var body=get('ì¡°ë‚´ìš©'); var title=get('ì¡°ì œëª©')||get('ì¡°ë¬¸ë²ˆí˜¸')||''; var parts=[];
  var hangs=[].slice.call(target.getElementsByTagName('í•­'));
  if(hangs.length){
    hangs.forEach(function(h){
      var ht=(h.getElementsByTagName('í•­ë‚´ìš©')[0]||{}).textContent||''; if(ht) parts.push('<div class="hang">'+sanitize(ht.trim())+'</div>');
      var hos=[].slice.call(h.getElementsByTagName('í˜¸'));
      hos.forEach(function(ho){
        var hot=(ho.getElementsByTagName('í˜¸ë‚´ìš©')[0]||{}).textContent||''; if(hot) parts.push('<div class="ho">'+sanitize(hot.trim())+'</div>');
        var moks=[].slice.call(ho.getElementsByTagName('ëª©'));
        moks.forEach(function(m){ var mk=(m.textContent||'').trim(); if(mk) parts.push('<div class="mok">'+sanitize(mk)+'</div>'); });
      });
    });
  }
  var articleBodyRaw = body ? ('<div>'+sanitize(body)+'</div>') : '';
  var html = articleBodyRaw + parts.join('');
  return {title:title, articleBodyRaw:html, hangs:[]};
}
function renderArticlePreview(opts){
  var lawName=opts.lawName, joLabel=opts.joLabel, data=opts.data;
  var modal=$('#modal'), body=$('#modalBody'), titleEl=$('#modalTitle');
  if(titleEl) titleEl.textContent = lawName+' '+joLabel+' (ì „ë¬¸)';
  var html='';
  if(data.articleBodyRaw){ html+= data.articleBodyRaw; }
  if(data.hangs && data.hangs.length){
    var parts=[];
    data.hangs.forEach(function(h){
      if(h.hTitle) parts.push('<div class="hang">'+ sanitize(h.hTitle)+'</div>');
      if(h.hos && h.hos.length){
        h.hos.forEach(function(ho){
          if(ho.hoText) parts.push('<div class="ho">'+ sanitize(ho.hoText)+'</div>');
          if(ho.moks && ho.moks.length){
            ho.moks.forEach(function(mk){ parts.push('<div class="mok">'+ sanitize(mk)+'</div>'); });
          }
        });
      }
    });
    html+=parts.join('');
  }
  if(!html) html='<div class="mini">ì¡°ë¬¸ ë³¸ë¬¸ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
  if(body) body.innerHTML=html;
  if(modal) modal.classList.add('on');
}

/* =============== UI ë„ìš°ë¯¸ =============== */
function toast(msg,ms){ms=ms||2200; var el=$('#toast'); var t=$('#toastMsg'); if(t) t.textContent=msg; if(el){ el.classList.add('on'); setTimeout(()=>el.classList.remove('on'),ms)}}
function skeleton(n){n=n||2; var arr=[]; for(var i=0;i<n;i++){arr.push('<li class="item"><div class="sk-line skeleton" style="width:58%"></div><div class="sk-gap"></div><div class="sk-line skeleton" style="width:32%"></div></li>')} return arr.join('')}
function appendResult(listEl, payload){
  var title=payload.title, kind=payload.kind, lawId=payload.lawId, lsiSeq=payload.lsiSeq, mst=payload.mst, articleURL=payload.articleURL, fullURL=payload.fullURL, lawName=payload.lawName, joText=payload.joText;
  var linkHtml='';
  if(joText){
    linkHtml += 'â‘  <button type="button" class="preview-btn">ì¡°ë¬¸ ë¯¸ë¦¬ë³´ê¸°</button> Â· ';
    if(kind==='law'){ linkHtml += 'â‘¡ <a class="go-article" href="'+articleURL+'" target="_blank" rel="noopener">ì¡°ë¬¸ ë°”ë¡œê°€ê¸°</a> Â· '; }
    else { linkHtml += 'â‘¡ <a class="go-ordin" href="'+fullURL+'" target="_blank" rel="noopener">ì¡°ë¬¸ ë°”ë¡œê°€ê¸°(ì „ì²´ ë‚´)</a> Â· '; }
  }
  linkHtml += 'â‘¢ <a class="go-full" href="'+fullURL+'" target="_blank" rel="noopener">'+(kind==='law'?'ë²•ë ¹ ì „ì²´':'ìì¹˜ë²•ê·œ ì „ì²´')+'</a>';
  var li=document.createElement('li'); li.className='item';
  li.innerHTML='<div class="item-line">'
      +'<span class="t">'+title+'</span>'
      +(kind==='law'
        ? (lawId ? '<span class="meta">ë²•ë ¹ID: '+lawId+(lsiSeq?(' Â· ì¼ë ¨ë²ˆí˜¸: '+lsiSeq):'')+'</span>' : '<span class="meta">ë²•ë ¹ID ë¯¸í™•ì¸</span>')
        : ((lawId||mst) ? '<span class="meta">ìì¹˜ë²•ê·œID: '+(lawId||'-')+(mst?(' Â· ì¼ë ¨ë²ˆí˜¸: '+mst):'')+'</span>' : '<span class="meta">ìì¹˜ë²•ê·œID ë¯¸í™•ì¸</span>')
       )
      +'<span class="links">'+linkHtml+'</span>'
    +'</div>';
  if(joText){
    if(kind==='law'){
      var a=li.querySelector('.go-article');
      if(a){
        a.addEventListener('click', function(e){
          e.preventDefault();
          var url=a.getAttribute('href');
          fetchTextDirectOrProxy(url).then(function(html){
            if(html && !isFailPage(html)) window.open(url,'_blank','noopener');
            else window.open(publicLawURL(title.split(' ì œ')[0]),'_blank','noopener');
          });
        });
      }
    }
    var btn=li.querySelector('.preview-btn');
    if(btn){
      btn.addEventListener('click', async function(){
        btn.disabled=true; btn.textContent='ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
        try{
          var data;
          if(kind==='law'){ var xmlURL=buildLawArticleXMLURL(lawId, joText); data=await fetchArticleXML(xmlURL); }
          else{ var idOrMst = lawId || mst; data = await fetchOrdinAndPick(idOrMst, joText.jo || 1); }
          if(!data){ toast('ì¡°ë¬¸ ì „ë¬¸ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); }
          else{ var joLabel=title.replace(lawName,'').trim(); renderArticlePreview({lawName:lawName, joLabel:joLabel, data:data}); }
        } finally { btn.disabled=false; btn.textContent='ì¡°ë¬¸ ë¯¸ë¦¬ë³´ê¸°'; }
      });
    }
  }
  listEl.appendChild(li);
}

/* =============== ì‹¤í–‰(run) =============== */
async function run(){
  var input=$('#input'); var resUl=$('#resList');
  try{
    if(resUl) resUl.innerHTML='';
    var text=input? (input.value||'') : '';
    if(!text.trim()){ toast('ë³¸ë¬¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”'); return; }
    if(resUl) resUl.innerHTML=skeleton(2);

    var cites=window.__LAW_EXTRACT__(text);
    if(!cites.length){
      if(resUl) resUl.innerHTML='<li class="item mini">ì¸ì‹ ê°€ëŠ¥í•œ ë²•ë ¹/ìì¹˜ë²•ê·œëª… ë˜ëŠ” ì¡°ë¬¸ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. Â· ì˜ˆ: ã€Œì‚¬ë¦½í•™êµë²•ã€ ì œ43ì¡°, ã€Œê²½ê¸°ë„êµìœ¡ì²­ í–‰ì •ê¸°êµ¬ ë° ì •ì› ì¡°ë¡€ã€ ì œ5ì¡°</li>';
      return;
    }

    var promises=cites.map(searchOneCitation);
    var results=await Promise.allSettled(promises);
    if(resUl) resUl.innerHTML='';

    for(const st of results){
      if(st.status!=='fulfilled') continue;
      const {row,kind,cite:it}=st.value;
      const lawName=it.name;
      const title=it.jo ? (lawName+' ì œ'+parseInt(it.jo,10)+(it.joi?('ì˜'+parseInt(it.joi,10)):'')+'ì¡°') : lawName;

      if(row){
        if(row.kind==='law'){
          const fullURL=buildLawFullHTMLURL(row.id);
          const articleURL=it.jo ? buildLawArticleURL(row.id,it) : '';
          appendResult(resUl,{kind:'law',title,lawId:row.id,lsiSeq:row.lsiSeq,mst:'',articleURL,fullURL,lawName,joText:it.jo?it:null});
        }else{
          const fullURL=buildOrdinFullHTMLURL(row.id,row.mst)||publicOrdinSearchURL(lawName);
          appendResult(resUl,{kind:'ordin',title,lawId:row.id,lsiSeq:'',mst:row.mst,articleURL:'',fullURL,lawName,joText:it.jo?it:null});
        }
      }else{
        const isOrdin=(kind==='ordin')||hasOrdinHint(lawName);
        const fullURL=isOrdin?publicOrdinSearchURL(lawName):publicLawURL(lawName);
        appendResult(resUl,{kind:isOrdin?'ordin':'law',title,lawId:'',lsiSeq:'',mst:'',articleURL:'',fullURL,lawName,joText:null});
      }
    }
  }catch(e){
    console.error(e);
    if(resUl) resUl.innerHTML='<li class="item mini">ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì…ë ¥ì„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</li>';
    toast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.');
  }
}
function bind(){
  var runBtn=$('#run'); if(runBtn){ runBtn.addEventListener('click', run); }
  var clearBtn=$('#clear');
  if(clearBtn){
    clearBtn.addEventListener('click', function(){
      var resUl = $('#resList'); if(resUl) resUl.innerHTML = '';
      var input = $('#input'); if(input){ input.value = ''; input.focus(); }
    });
  }
  var input=$('#input');
  if(input){
    input.addEventListener('keydown', function(e){
      if(e.key==='Enter' && !e.altKey && !e.shiftKey && !e.ctrlKey){ e.preventDefault(); run(); }
    });
  }
  (function bindModal(){
    var closeBtn=$('#modalClose'); if(closeBtn){ closeBtn.addEventListener('click', function(){ var m=$('#modal'); if(m) m.classList.remove('on'); }) }
    var modal=$('#modal'); if(modal){ modal.addEventListener('click', function(e){ if(e.target && e.target.id==='modal'){ modal.classList.remove('on'); } }); }
  })();
}
if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', bind); } else { bind(); }
</script>
</body>
</html>
