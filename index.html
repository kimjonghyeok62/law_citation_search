<script>
(function(){
  'use strict';

  /* ===== ê¸°ì¡´ ìƒë‹¨ Core/ê²€ìƒ‰/ë¯¸ë¦¬ë³´ê¸° ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ë‘ì„¸ìš” ===== */
  /* ì´ ë¸”ë¡ì—ëŠ” â€œì¶”ì¶œë¶€â€ë§Œ ìƒˆë¡œ ë„£ì—ˆìŠµë‹ˆë‹¤. í•„ìš” ë³€ìˆ˜ ì¬ì‚¬ìš©ìš© ìµœì†Œ í—¬í¼ë§Œ ë‘¡ë‹ˆë‹¤. */

  // ê³µí†µ ì •ê·œì‹ í† ë§‰
  var D='\\d+';
  var JO='ì œ\\s*('+D+')\\s*ì¡°(?:\\s*ì˜\\s*('+D+'))?';
  var HANG='(?:\\s*ì œ?\\s*('+D+')\\s*í•­)?';
  var HO='(?:\\s*ì œ?\\s*('+D+')\\s*í˜¸)?';
  var MOK='(?:\\s*([ê°€-í£])\\s*ëª©)?';

  // â˜… ì¸ìš©ë¶€í˜¸ ìœ ë¬´ì™€ ìƒê´€ì—†ì´ í•œ ë²ˆì— ì¡ëŠ” â€œìŠˆí¼ íŒ¨í„´â€
  //  - ë²•ëª…: í•œê¸€/ì˜ë¬¸/ìˆ«ì/ì Â·Â· ë° ê³µë°± + (ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™) [+ (ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)] ê¹Œì§€
  //  - ì•ë’¤ì— ã€Œã€ã€ã€â€œâ€"â€™' ë“± ì–´ë–¤ ì¸ìš©ë¶€í˜¸ê°€ ì™€ë„ OK (ì˜µì…˜)
  //  - ì¡°ë¬¸(ì œnì¡°ì˜m/í•­/í˜¸/ëª©)ì€ ìˆì–´ë„, ì—†ì–´ë„ OK
  var SUPER_RE = new RegExp(
    [
      // ì—´ê¸° ì¸ìš©ë¶€í˜¸(ì˜µì…˜)
      '[ã€Œã€â€œ"\']?\\s*',
      // ë²•ëª… ë³¸ì²´
      '([ê°€-í£A-Za-z0-9Â·ã†\\s]+?(?:ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)(?:\\s*(?:ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™))?)',
      // ë‹«ê¸° ì¸ìš©ë¶€í˜¸(ì˜µì…˜)
      '\\s*[ã€ã€â€"\']?',
      // ì¡°ë¬¸(ì˜µì…˜)
      '(?:\\s*', JO, HANG, HO, MOK, ')?'
    ].join(''),
    'gu'
  );

  // â€œê°™ì€ ë²•/ë™ë²• â€¦â€ ì°¸ì¡° ë°°ì œ
  function skipCtx(name){
    var s=(name||'').replace(/\s+/g,'');
    return s==='ê°™ì€ë²•'||s==='ë™ë²•'||s==='ê°™ì€ë²•ì‹œí–‰ë ¹'||s==='ë™ë²•ì‹œí–‰ë ¹'||s==='ê°™ì€ë²•ì‹œí–‰ê·œì¹™'||s==='ë™ë²•ì‹œí–‰ê·œì¹™';
  }

  // ë²•ëª… íƒ€ë‹¹ì„± ìµœì†Œ í•„í„°
  function isLikelyLawName(name){
    var s=(name||'').trim(); if(!s) return false;
    if(/^(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(s)) return false;
    if(/ë°©ë²•$/u.test(s)) return false; // ì œì¶œë°©ë²• ë“± ì˜¤íƒ ë°©ì§€
    var core = s.replace(/\s*(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)$/u,'');
    if(!/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(core)) return false;
    return core.replace(/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u,'').length>=1;
  }

  // ë²•ëª… ì •ì œ(â€œâ€¦ ì‹œí–‰ë ¹/ì‹œí–‰ê·œì¹™â€ ê²°í•©, ë§ˆì§€ë§‰ ì ‘ë¯¸ì–´ê¹Œì§€ ê¹”ë”íˆ)
  function refineLawName(name){
    var s=(name||'').trim(); if(!s) return s;
    s=s.replace(/^(?:ê¹Œì§€|ë°|ë˜ëŠ”|ë“±|ê´€ë ¨|ê´€í•œ|ë”°ë¥¸|ì—\s*ë”°ë¥¸|ì—\s*ì˜í•œ|ì˜)\s+/u,'');
    var toks=s.split(/\s+/);
    var last=-1;
    for(var i=toks.length-1;i>=0;i--){
      if(/(ë²•|ë²•ë¥ |ì¡°ë¡€|ê·œì¹™)$/u.test(toks[i])){ last=i; break; }
    }
    if(last>=0){
      if(toks[last+1] && /^(ì‹œí–‰ë ¹|ì‹œí–‰ê·œì¹™)$/u.test(toks[last+1])) return toks.slice(0,last+2).join(' ');
      return toks.slice(0,last+1).join(' ');
    }
    return s;
  }

  // ê³µê°œìš© ì´ë¦„(ì¸ìš©ë¶€í˜¸ ë“± ì œê±°)
  function cleanDisplay(s){ return (s||'').replace(/[\"â€œâ€'â€˜â€™\[\]\(\)ã€Œã€ã€ã€]/g,'').trim(); }

  // ğŸ”§ ìƒˆ ì¶”ì¶œê¸°
  function extract(text){
    var src=(text||'')
      .replace(/[\u200B-\u200D\uFEFF]/g,'')
      .replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g,' ')
      .replace(/\s+/g,' ')
      .trim();

    var out=[], seen=new Set();
    SUPER_RE.lastIndex=0; // g í”Œë˜ê·¸ ì´ˆê¸°í™”

    var m;
    while((m=SUPER_RE.exec(src))){
      var nm = refineLawName(cleanDisplay(m[1]||''));
      if(!nm || skipCtx(nm) || !isLikelyLawName(nm)) continue;

      var jo=m[2]||null, joi=m[3]||null, hang=m[4]||null, ho=m[5]||null, mok=m[6]||null;

      // â€œì œ n ì¡° ë²•ëª… â€¦â€ í˜•íƒœ ì˜¤íƒ ë°©ì§€: ë§¤ì¹˜ ì‹œì‘ ì´ì „ 20ì ì•ˆìª½ì´ â€˜ì œ n ì¡°â€™ë¡œ ëë‚˜ë©´ ìŠ¤í‚µ
      var prev = src.slice(Math.max(0, SUPER_RE.lastIndex - (m[0]||'').length - 20), SUPER_RE.lastIndex - (m[0]||'').length);
      if(/ì œ\s*\d+\s*ì¡°\s*$/u.test(prev)) continue;

      var key=[nm,jo||'',joi||'',hang||'',ho||'',mok||''].join('|');
      if(seen.has(key)) continue;
      seen.add(key);

      out.push({name:nm, jo:jo, joi:joi, hang:hang, ho:ho, mok:mok});
    }

    // ê°™ì€ ì´ë¦„ì˜ ì¡°ë¬¸/ì´ë¦„-only ë™ì‹œ ì¡´ì¬ì‹œ, ì¡°ë¬¸ ìˆëŠ” ìª½ì„ ìš°ì„ 
    var withArticle=new Set(out.filter(x=>!!x.jo).map(x=>x.name));
    out=out.filter(x=> x.jo ? true : !withArticle.has(x.name));

    // ì´ë¦„-only ìµœì¢… ì¤‘ë³µ ì œê±°
    var seenNameOnly=new Set();
    out=out.filter(function(x){
      if(x.jo) return true;
      var k='nameonly|'+x.name;
      if(seenNameOnly.has(k)) return false;
      seenNameOnly.add(k);
      return true;
    });

    return out;
  }

  /* ===== ì•„ë˜ë¶€í„°ëŠ” ê¸°ì¡´ ì½”ë“œì˜ run()ì— ì´ ì¶”ì¶œê¸°ë¥¼ ê½‚ì•„ì¤ë‹ˆë‹¤ ===== */

  // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ: ê¸°ì¡´ run()ì´ ì‚¬ìš©
  window.__LAW_EXTRACT__ = extract;

})();
</script>
